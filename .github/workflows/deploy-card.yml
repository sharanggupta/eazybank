# =============================================================================
# Card Service Pipeline
# =============================================================================
#
# Triggers when:
#   - Changes pushed to card/** OR
#   - Changes pushed to deploy/helm/services/card/**
#   - Manual trigger via workflow_dispatch
#
# Skips if only documentation/config changes
#
# Calls the reusable deploy-service.yml workflow
#
# =============================================================================

name: Deploy Card Service

on:
  push:
    branches:
      - main
    paths:
      - 'card/**'
      - 'deploy/helm/services/card/**'
      - '.github/workflows/deploy-card.yml'
      - '.github/workflows/deploy-service.yml'
      - '.github/workflows/get-version.yml'
  workflow_dispatch:

env:
  REGISTRY: ghcr.io
  IMAGE_PREFIX: ${{ github.repository_owner }}/eazybank

jobs:
  deploy:
    uses: ./.github/workflows/deploy-service.yml
    with:
      service: card
      registry: ghcr.io
      image_prefix: ${{ github.repository_owner }}/eazybank
    secrets:
      registry_token: ${{ secrets.GITHUB_TOKEN }}
      kube_config: ${{ secrets.KUBE_CONFIG }}
      kube_config_prod: ${{ secrets.KUBE_CONFIG_PROD }}
      db_password: ${{ secrets.DB_PASSWORD }}
      db_password_prod: ${{ secrets.DB_PASSWORD_PROD }}

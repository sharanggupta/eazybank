# =============================================================================
# Gateway Service Pipeline
# =============================================================================
#
# Triggers when:
#   - Changes pushed to gateway/** OR
#   - Changes pushed to deploy/helm/services/gateway/**
#   - Manual trigger via workflow_dispatch
#
# Skips if only documentation/config changes
#
# Calls the reusable deploy-service.yml workflow
#
# Note: Gateway does NOT require DB_PASSWORD since it doesn't have a database
#
# =============================================================================

name: Deploy Gateway

on:
  push:
    branches:
      - main
    paths:
      - 'gateway/**'
      - 'deploy/helm/services/gateway/**'
      - '.github/workflows/deploy-gateway.yml'
      - '.github/workflows/deploy-service.yml'
    paths-ignore:
      - '**.md'
      - '**.txt'
  workflow_dispatch:

env:
  REGISTRY: ghcr.io
  IMAGE_PREFIX: ${{ github.repository_owner }}/eazybank

jobs:
  deploy:
    uses: ./.github/workflows/deploy-service.yml
    with:
      service: gateway
      registry: ghcr.io
      image_prefix: ${{ github.repository_owner }}/eazybank
    secrets:
      github_token: ${{ secrets.GITHUB_TOKEN }}
      kube_config: ${{ secrets.KUBE_CONFIG }}
      kube_config_prod: ${{ secrets.KUBE_CONFIG_PROD }}
      db_password: ${{ secrets.DB_PASSWORD }}
      db_password_prod: ${{ secrets.DB_PASSWORD_PROD }}
